<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>checkcheck - ระบบจัดการสต็อกสินค้า</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root {
            --primary-color: #4e54c8;
            --secondary-color: #8f94fb;
            --accent-color: #ff6b6b;
            --success-color: #2ecc71;
            --warning-color: #ff9f43;
            --text-color: #333;
            --white: #ffffff;
            --shadow: 0 8px 30px rgba(0,0,0,0.15);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Prompt', sans-serif;
            color: var(--text-color);
            min-height: 100vh;
            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            display: flex;
            flex-direction: column;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* --- Login System Styles --- */
        .login-container {
            width: 100%; height: 100vh; display: flex; justify-content: center; align-items: center;
            position: fixed; top: 0; left: 0; z-index: 2000;
            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
            background-size: 400% 400%; animation: gradientBG 15s ease infinite;
        }

        .login-card {
            background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(20px);
            padding: 40px; border-radius: 20px; width: 100%; max-width: 400px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2); text-align: center;
        }

        .login-logo { width: 100px; border-radius: 50%; margin-bottom: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .login-title { color: var(--primary-color); margin-bottom: 5px; font-size: 1.8rem; }
        .login-subtitle { color: #666; margin-bottom: 30px; font-size: 0.9rem; }
        .toggle-text { margin-top: 20px; font-size: 0.9rem; color: #555; }
        .toggle-text span { color: var(--primary-color); cursor: pointer; font-weight: 600; text-decoration: underline; }

        /* --- Change Password Modal Styles --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.5); z-index: 3000;
            display: none; justify-content: center; align-items: center;
            backdrop-filter: blur(5px);
        }

        .modal-card {
            background: white; padding: 30px; border-radius: 20px;
            width: 90%; max-width: 380px; text-align: center;
            position: relative; box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }

        .close-modal-btn {
            position: absolute; top: 15px; right: 20px;
            font-size: 1.5rem; color: #aaa; cursor: pointer; transition: 0.3s;
        }
        .close-modal-btn:hover { color: var(--accent-color); }

        /* --- App Styles --- */
        #appPage { display: none; width: 100%; }

        .navbar {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px 40px; background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px); box-shadow: 0 2px 15px rgba(0,0,0,0.05);
            position: sticky; top: 0; z-index: 1000;
        }

        /* === ส่วนโลโก้เมนูบาร์ที่ปรับปรุงใหม่ === */
        .nav-brand {
            display: flex;
            align-items: center;
            gap: 12px; /* ระยะห่างระหว่างไอคอนกับตัวหนังสือ */
            cursor: pointer;
            text-decoration: none;
        }

        /* กล่องไอคอนสี่เหลี่ยมมุมมน */
        .brand-icon-box {
            width: 42px;
            height: 42px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: 12px; /* มุมมนทันสมัย */
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.4rem;
            box-shadow: 0 4px 12px rgba(78, 84, 200, 0.4); /* เงาฟุ้งๆ */
            transition: transform 0.3s;
        }

        .nav-brand:hover .brand-icon-box {
            transform: rotate(10deg) scale(1.05); /* ลูกเล่นหมุนนิดๆ ตอนเอาเมาส์ชี้ */
        }

        /* ตัวหนังสือแบบไล่สี */
        .brand-text {
            font-size: 1.6rem;
            font-weight: 800; /* หนาพิเศษ */
            letter-spacing: -0.5px;
            background: linear-gradient(to right, var(--primary-color), var(--accent-color)); /* ไล่สีจากม่วงไปส้ม */
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent; /* ทำให้ตัวหนังสือโปร่งใสเห็นพื้นหลังไล่สี */
        }
        /* ================================= */

        .nav-menu { display: flex; gap: 20px; align-items: center; }
        .nav-item { text-decoration: none; color: #555; font-weight: 600; font-size: 0.95rem; cursor: pointer; transition: color 0.3s; display: flex; align-items: center; gap: 6px; }
        .nav-item:hover { color: var(--primary-color); }
        
        .nav-item-map { color: var(--primary-color); background: rgba(78, 84, 200, 0.1); padding: 8px 15px; border-radius: 20px; }
        .nav-item-map:hover { background: var(--primary-color); color: white; }

        .user-actions { display: flex; align-items: center; gap: 12px; padding-left: 20px; border-left: 2px solid #eee; }
        .user-name { font-weight: bold; color: var(--primary-color); margin-right: 5px; display: flex; align-items: center; gap: 5px;}
        
        .btn-icon-gray {
            background: #f0f2f5; color: #666; border: none; width: 35px; height: 35px;
            border-radius: 50%; cursor: pointer; transition: all 0.3s;
            display: flex; align-items: center; justify-content: center;
        }
        .btn-icon-gray:hover { background: #e4e6eb; color: var(--primary-color); transform: rotate(15deg); }

        .btn-logout {
            background-color: #fff0f0; color: var(--accent-color);
            border: 1px solid #ffcccc; padding: 8px 20px;
            border-radius: 30px; font-weight: 600; cursor: pointer;
            transition: all 0.3s; display: flex; align-items: center; gap: 8px; font-size: 0.9rem;
        }
        .btn-logout:hover { background-color: var(--accent-color); color: white; border-color: var(--accent-color); box-shadow: 0 4px 10px rgba(255, 107, 107, 0.3); }

        .container { max-width: 1000px; margin: 30px auto; width: 100%; padding: 0 20px; flex: 1; }
        
        /* Form & Cards */
        .card { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border-radius: 20px; padding: 30px; box-shadow: var(--shadow); margin-bottom: 25px; }
        .form-grid { display: grid; grid-template-columns: 2fr 1fr 1fr auto; gap: 15px; align-items: end; }
        .form-group { margin-bottom: 15px; text-align: left; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: #555; font-size: 0.9rem; }
        .form-control { width: 100%; padding: 12px 15px; border: 2px solid #eee; border-radius: 10px; font-family: 'Prompt', sans-serif; font-size: 1rem; transition: all 0.3s; }
        .form-control:focus { border-color: var(--primary-color); outline: none; }

        .btn { padding: 12px 25px; border: none; border-radius: 10px; cursor: pointer; font-family: 'Prompt', sans-serif; font-weight: 600; font-size: 1rem; transition: all 0.3s; display: inline-flex; align-items: center; gap: 8px; width: 100%; justify-content: center;}
        .btn-primary { background: linear-gradient(to right, #4e54c8, #8f94fb); color: white; box-shadow: 0 4px 15px rgba(78, 84, 200, 0.3); }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(78, 84, 200, 0.5); }
        .btn-danger { background-color: var(--accent-color); color: white; padding: 6px 12px; font-size: 0.85rem; border-radius: 8px; width: auto;}
        
        .btn-map-small {
            background-color: #fff; color: #4285F4; border: 1px solid #4285F4;
            padding: 6px 12px; font-size: 0.85rem; border-radius: 8px;
            cursor: pointer; transition: 0.2s; margin-right: 5px;
        }
        .btn-map-small:hover { background-color: #4285F4; color: white; }

        /* Header & Footer */
        header { text-align: center; margin-bottom: 30px; color: white; }
        header h1 { font-weight: 600; font-size: 3rem; margin-bottom: 5px; text-shadow: 2px 2px 10px rgba(0,0,0,0.3); }
        header p { font-size: 1.1rem; text-shadow: 1px 1px 5px rgba(0,0,0,0.2); opacity: 0.9; margin-bottom: 20px; }
        .logo-img { max-width: 200px; height: auto; border-radius: 50%; margin-bottom: 15px; border: 5px solid rgba(255, 255, 255, 0.5); box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        
        .header-search-wrapper { max-width: 500px; margin: 0 auto 30px auto; position: relative; }
        .header-search-wrapper input { width: 100%; padding: 15px 25px 15px 55px; border-radius: 50px; border: none; font-size: 1.1rem; font-family: 'Prompt', sans-serif; box-shadow: 0 5px 20px rgba(0,0,0,0.2); background: rgba(255, 255, 255, 0.95); }
        .header-search-wrapper input:focus { outline: none; transform: scale(1.02); box-shadow: 0 8px 25px rgba(0,0,0,0.3); }
        .header-search-wrapper i { position: absolute; left: 20px; top: 50%; transform: translateY(-50%); font-size: 1.3rem; color: var(--primary-color); }

        .footer-card { text-align: center; padding: 20px; margin-top: 20px; }
        .contact-grid { display: flex; justify-content: center; gap: 30px; flex-wrap: wrap; margin-top: 10px;}
        .contact-item { display: flex; align-items: center; gap: 8px; color: #555; }
        .copyright { margin-top: 20px; border-top: 1px solid #eee; padding-top: 15px; font-size: 0.8rem; color: #888; }

        /* Table */
        .table-container { overflow-x: auto; }
        table { width: 100%; border-collapse: separate; border-spacing: 0 8px; margin-top: 5px; min-width: 800px; }
        th { color: #666; font-weight: 600; text-align: left; padding: 15px; border-bottom: 1px solid #eee; }
        td { padding: 15px; vertical-align: middle; background: #fff; border-top: 1px solid #f0f0f0; border-bottom: 1px solid #f0f0f0; }
        tr td:first-child { border-top-left-radius: 10px; border-bottom-left-radius: 10px; border-left: 1px solid #f0f0f0; }
        tr td:last-child { border-top-right-radius: 10px; border-bottom-right-radius: 10px; border-right: 1px solid #f0f0f0; }
        .qty-wrapper { display: flex; align-items: center; gap: 10px; }
        .btn-qty { width: 32px; height: 32px; border-radius: 50%; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; }
        .btn-minus { background-color: var(--warning-color); }
        .btn-plus { background-color: var(--success-color); }
        .status-badge { padding: 6px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; }
        .status-in { background-color: #e3f9e5; color: #155724; }
        .status-low { background-color: #fff8dd; color: #b58900; }
        .status-out { background-color: #ffeaea; color: #c0392b; }

        @media (max-width: 768px) {
            .form-grid { grid-template-columns: 1fr; }
            .navbar { padding: 15px 20px; flex-direction: column; gap: 15px; }
            .nav-menu { width: 100%; justify-content: center; font-size: 0.85rem; flex-wrap: wrap;}
            .user-actions { border-left: none; padding-left: 0; margin-top: 10px; }
        }
    </style>
</head>
<body>

    <div id="loginPage" class="login-container">
        <div class="login-card">
            <img src="https://png.pngtree.com/png-vector/20230728/ourmid/pngtree-supermarket-clipart-an-illustration-of-a-young-woman-at-the-grocery-vector-png-image_6825234.png" 
                 class="login-logo" alt="Logo">
            
            <h2 class="login-title" id="formTitle">ยินดีต้อนรับ</h2>
            <p class="login-subtitle">กรุณาเข้าสู่ระบบเพื่อจัดการสต็อกสินค้า</p>

            <div style="text-align: left;">
                <div class="form-group">
                    <label>ชื่อผู้ใช้งาน (Username)</label>
                    <input type="text" id="loginUser" class="form-control" placeholder="ระบุชื่อผู้ใช้งาน">
                </div>
                <div class="form-group" style="margin-top: 15px;">
                    <label>รหัสผ่าน (Password)</label>
                    <input type="password" id="loginPass" class="form-control" placeholder="ระบุรหัสผ่าน">
                </div>
                <button class="btn btn-primary" style="margin-top: 25px;" onclick="handleLoginAction()">
                    <i class="fas fa-sign-in-alt"></i> <span id="btnText">เข้าสู่ระบบ</span>
                </button>
            </div>

            <p class="toggle-text">
                <span id="toggleLink" onclick="toggleForm()">ยังไม่มีบัญชี? สมัครสมาชิก</span>
            </p>
        </div>
    </div>

    <div id="appPage">
        <nav class="navbar">
            <div class="nav-brand" onclick="window.scrollTo(0,0)">
                <div class="brand-icon-box">
                    <i class="fas fa-check-double"></i>
                </div>
                <span class="brand-text">check!check!</span>
            </div>
            
            <div class="nav-menu">
                <a class="nav-item" onclick="location.reload()"><i class="fas fa-home"></i> หน้าหลัก</a>
                
                <a class="nav-item nav-item-map" onclick="searchNearbyStore('ร้านขายส่ง')">
                    <i class="fas fa-map-marked-alt"></i> ร้านส่งใกล้ฉัน
                </a>
                
                <a class="nav-item" onclick="exportData()"><i class="fas fa-file-export"></i> ส่งออก</a>
                
                <div class="user-actions">
                    <span class="user-name"><i class="fas fa-user-circle"></i> <span id="displayUser">User</span></span>
                    
                    <button class="btn-icon-gray" onclick="openChangePassModal()" title="เปลี่ยนรหัสผ่าน">
                        <i class="fas fa-key"></i>
                    </button>

                    <button class="btn-logout" onclick="logout()">
                        <i class="fas fa-power-off"></i> ออกจากระบบ
                    </button>
                </div>
            </div>
        </nav>

        <div class="container">
            <header>
                <img src="https://png.pngtree.com/png-vector/20230728/ourmid/pngtree-supermarket-clipart-an-illustration-of-a-young-woman-at-the-grocery-vector-png-image_6825234.png" 
                     class="logo-img" alt="Logo">
                <h1>check!check!</h1>
                <p>ระบบจัดการสต็อกสินค้า สีสันสดใส ใช้งานง่าย</p>

                <div class="header-search-wrapper">
                    <i class="fas fa-search"></i>
                    <input type="text" id="headerSearchInput" placeholder="ค้นหาสินค้าด่วน..." onkeyup="syncSearch(this.value)">
                </div>
            </header>

            <div class="card">
                <div class="form-grid">
                    <div class="form-group">
                        <label>ชื่อสินค้า</label>
                        <input type="text" id="productName" class="form-control" placeholder="เช่น น้ำดื่ม, ขนมปัง...">
                    </div>
                    <div class="form-group">
                        <label>จำนวนเริ่มต้น</label>
                        <input type="number" id="productQty" class="form-control" placeholder="0">
                    </div>
                    <div class="form-group">
                        <label>ราคาต่อหน่วย</label>
                        <input type="number" id="productPrice" class="form-control" placeholder="0.00">
                    </div>
                    <button class="btn btn-primary" onclick="addProduct()">
                        <i class="fas fa-plus-circle"></i> เพิ่มสินค้า
                    </button>
                </div>
            </div>

            <div class="card">
                <div class="table-container">
                    <table id="stockTable">
                        <thead>
                            <tr>
                                <th width="25%">ชื่อสินค้า</th>
                                <th width="15%">ราคา</th>
                                <th width="20%">คงเหลือ (ปรับสต็อก)</th>
                                <th width="10%">สถานะ</th>
                                <th width="15%">วันที่บันทึก</th>
                                <th width="15%">จัดการ</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody"></tbody>
                    </table>
                    <div id="emptyState" style="text-align: center; padding: 40px; color: #aaa; display: none;">
                        <i class="fas fa-box-open" style="font-size: 3rem; margin-bottom: 10px; color: #e0e0e0;"></i>
                        <p>ยังไม่มีข้อมูลสินค้าในสต็อก</p>
                    </div>
                </div>
            </div>

            <footer class="card footer-card">
                <h3 style="color:var(--primary-color); margin-bottom:15px;"><i class="fas fa-headset"></i> ติดต่อเจ้าหน้าที่</h3>
                <div class="contact-grid">
                    <div class="contact-item"><i class="fas fa-phone-alt"></i> 02-123-4567</div>
                    <div class="contact-item"><i class="fab fa-line"></i> @checkcheck</div>
                </div>
                <div class="copyright"><p>© 2026 check!check! System. All rights reserved.</p></div>
            </footer>
        </div>
    </div>

    <div id="changePassModal" class="modal-overlay">
        <div class="modal-card">
            <i class="fas fa-times close-modal-btn" onclick="closeChangePassModal()"></i>
            <h3 style="color: var(--primary-color); margin-bottom: 20px;">เปลี่ยนรหัสผ่าน</h3>
            <div class="form-group">
                <label>รหัสผ่านเดิม</label>
                <input type="password" id="oldPassInput" class="form-control" placeholder="ระบุรหัสผ่านปัจจุบัน">
            </div>
            <div class="form-group">
                <label>รหัสผ่านใหม่</label>
                <input type="password" id="newPassInput" class="form-control" placeholder="ระบุรหัสผ่านใหม่">
            </div>
            <button class="btn btn-primary" onclick="handleChangePassword()">
                <i class="fas fa-save"></i> บันทึกรหัสผ่านใหม่
            </button>
        </div>
    </div>

    <script>
        // --- ส่วนจัดการ Login / Register ---
        let isLoginMode = true; 

        document.addEventListener('DOMContentLoaded', () => {
            const loggedUser = localStorage.getItem('currentUser');
            if(loggedUser) { showApp(loggedUser); }
            loadProducts();
        });

        function toggleForm() {
            isLoginMode = !isLoginMode;
            const title = document.getElementById('formTitle');
            const btnText = document.getElementById('btnText');
            const toggleLink = document.getElementById('toggleLink');
            
            if (isLoginMode) {
                title.innerText = "ยินดีต้อนรับ";
                btnText.innerText = "เข้าสู่ระบบ";
                toggleLink.innerText = "ยังไม่มีบัญชี? สมัครสมาชิก";
            } else {
                title.innerText = "สมัครสมาชิกใหม่";
                btnText.innerText = "ยืนยันการสมัคร";
                toggleLink.innerText = "มีบัญชีอยู่แล้ว? เข้าสู่ระบบ";
            }
            document.getElementById('loginUser').value = '';
            document.getElementById('loginPass').value = '';
        }

        function handleLoginAction() {
            const user = document.getElementById('loginUser').value.trim();
            const pass = document.getElementById('loginPass').value.trim();

            if(!user || !pass) { alert("กรุณากรอกข้อมูลให้ครบถ้วน"); return; }

            if(isLoginMode) {
                const savedUser = JSON.parse(localStorage.getItem('users')) || [];
                const found = savedUser.find(u => u.username === user && u.password === pass);

                if(found) {
                    localStorage.setItem('currentUser', user);
                    showApp(user);
                } else {
                    alert("ชื่อผู้ใช้หรือรหัสผ่านไม่ถูกต้อง");
                }
            } else {
                const savedUser = JSON.parse(localStorage.getItem('users')) || [];
                if(savedUser.some(u => u.username === user)) {
                    alert("ชื่อผู้ใช้งานนี้ถูกใช้ไปแล้ว");
                    return;
                }
                savedUser.push({ username: user, password: pass });
                localStorage.setItem('users', JSON.stringify(savedUser));
                alert("สมัครสมาชิกสำเร็จ! กรุณาเข้าสู่ระบบ");
                toggleForm();
            }
        }

        function showApp(username) {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('appPage').style.display = 'block';
            document.getElementById('displayUser').innerText = username;
        }

        function logout() {
            if(confirm("ต้องการออกจากระบบใช่หรือไม่?")) {
                localStorage.removeItem('currentUser');
                location.reload();
            }
        }

        // --- ส่วนเปลี่ยนรหัสผ่าน ---
        function openChangePassModal() { document.getElementById('changePassModal').style.display = 'flex'; }
        function closeChangePassModal() { 
            document.getElementById('changePassModal').style.display = 'none';
            document.getElementById('oldPassInput').value = '';
            document.getElementById('newPassInput').value = '';
        }

        function handleChangePassword() {
            const oldPass = document.getElementById('oldPassInput').value.trim();
            const newPass = document.getElementById('newPassInput').value.trim();
            const currentUser = localStorage.getItem('currentUser');

            if(!oldPass || !newPass) { alert("กรุณากรอกข้อมูลให้ครบถ้วน"); return; }

            let users = JSON.parse(localStorage.getItem('users')) || [];
            const userIndex = users.findIndex(u => u.username === currentUser);

            if (userIndex !== -1) {
                if (users[userIndex].password === oldPass) {
                    users[userIndex].password = newPass;
                    localStorage.setItem('users', JSON.stringify(users));
                    alert("เปลี่ยนรหัสผ่านเรียบร้อยแล้ว!");
                    closeChangePassModal();
                } else {
                    alert("รหัสผ่านเดิมไม่ถูกต้อง");
                }
            }
        }

        // --- ส่วนจัดการสต็อกสินค้า ---
        function getCurrentDateTime() {
            return new Date().toLocaleDateString('th-TH', { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
        }
        function syncSearch(value) { searchProduct(value); }
        function exportData() {
            const products = localStorage.getItem('products');
            if (!products || products === '[]') { alert('ไม่มีข้อมูล'); return; }
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(products);
            const dl = document.createElement('a');
            dl.setAttribute("href", dataStr); dl.setAttribute("download", "stock_data.json");
            document.body.appendChild(dl); dl.click(); dl.remove();
        }
        function addProduct() {
            const name = document.getElementById('productName').value;
            const qty = document.getElementById('productQty').value;
            const price = document.getElementById('productPrice').value;
            if (!name || !qty || !price) { alert('กรุณากรอกข้อมูลให้ครบ'); return; }
            const product = { id: Date.now(), name, qty: parseInt(qty), price: parseFloat(price), timestamp: getCurrentDateTime() };
            let products = JSON.parse(localStorage.getItem('products')) || [];
            products.push(product);
            localStorage.setItem('products', JSON.stringify(products));
            document.getElementById('productName').value = ''; document.getElementById('productQty').value = ''; document.getElementById('productPrice').value = '';
            loadProducts();
        }
        function updateStock(id, change) {
            let products = JSON.parse(localStorage.getItem('products'));
            const idx = products.findIndex(p => p.id === id);
            if (idx !== -1) {
                let newQty = products[idx].qty + change;
                if (newQty < 0) newQty = 0; 
                products[idx].qty = newQty;
                localStorage.setItem('products', JSON.stringify(products));
                loadProducts();
                if(document.getElementById('headerSearchInput').value) searchProduct(document.getElementById('headerSearchInput').value);
            }
        }
        function deleteProduct(id) {
            if(confirm('ยืนยันการลบ?')) {
                let products = JSON.parse(localStorage.getItem('products'));
                products = products.filter(p => p.id !== id);
                localStorage.setItem('products', JSON.stringify(products));
                loadProducts();
                if(document.getElementById('headerSearchInput').value) searchProduct(document.getElementById('headerSearchInput').value);
            }
        }
        function searchProduct(text) {
            text = text.toLowerCase();
            const rows = document.querySelectorAll('#tableBody tr');
            rows.forEach(row => {
                const name = row.cells[0].textContent.toLowerCase();
                row.style.display = name.includes(text) ? '' : 'none';
            });
        }

        // --- ฟังก์ชัน Google Maps & Location ---
        function searchNearbyStore(keyword) {
            if (navigator.geolocation) {
                if(!confirm(`ต้องการค้นหา "${keyword}" จากตำแหน่งปัจจุบันของคุณหรือไม่?`)) return;
                navigator.geolocation.getCurrentPosition((position) => {
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;
                    const url = `https://www.google.com/maps/search/${keyword}/@${lat},${lon},14z`;
                    window.open(url, '_blank');
                }, (error) => {
                    alert('ไม่สามารถระบุตำแหน่งได้ ระบบจะค้นหาแบบทั่วไปแทน');
                    const url = `https://www.google.com/maps/search/${keyword}`;
                    window.open(url, '_blank');
                });
            } else {
                alert("เบราว์เซอร์ของคุณไม่รองรับการระบุตำแหน่ง");
                const url = `https://www.google.com/maps/search/${keyword}`;
                window.open(url, '_blank');
            }
        }

        function loadProducts() {
            const products = JSON.parse(localStorage.getItem('products')) || [];
            const tableBody = document.getElementById('tableBody');
            const emptyState = document.getElementById('emptyState');
            tableBody.innerHTML = '';
            if (products.length === 0) emptyState.style.display = 'block';
            else {
                emptyState.style.display = 'none';
                products.sort((a, b) => b.id - a.id).forEach(p => {
                    let badge = p.qty === 0 ? '<span class="status-badge status-out">หมด</span>' :
                                p.qty < 5 ? '<span class="status-badge status-low">ใกล้หมด</span>' :
                                '<span class="status-badge status-in">ปกติ</span>';
                    
                    const row = `<tr>
                        <td><strong>${p.name}</strong></td>
                        <td>${p.price.toLocaleString()} ฿</td>
                        <td>
                            <div class="qty-wrapper">
                                <button class="btn-qty btn-minus" onclick="updateStock(${p.id}, -1)"><i class="fas fa-minus"></i></button>
                                <span>${p.qty}</span>
                                <button class="btn-qty btn-plus" onclick="updateStock(${p.id}, 1)"><i class="fas fa-plus"></i></button>
                            </div>
                        </td>
                        <td>${badge}</td>
                        <td><span style="font-size:0.8rem;color:#888;">${p.timestamp || '-'}</span></td>
                        <td>
                            <button class="btn-map-small" onclick="searchNearbyStore('${p.name} ราคาส่ง')" title="หาร้านส่ง ${p.name} ใกล้ฉัน">
                                <i class="fas fa-map-marker-alt"></i> หาร้าน
                            </button>
                            <button class="btn btn-danger" onclick="deleteProduct(${p.id})"><i class="fas fa-trash"></i></button>
                        </td>
                    </tr>`;
                    tableBody.innerHTML += row;
                });
            }
        }
    </script>
</body>
</html>